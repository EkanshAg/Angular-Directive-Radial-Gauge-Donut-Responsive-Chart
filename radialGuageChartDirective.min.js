angular.module('myApp').directive('customRadialGauge',function($rootScope){return{restrict:'E',link:function(scope,element,attrs){var data=[];var middle;function _init(data1){var w;var h;if(attrs.width!=undefined&&attrs.width.indexOf('%')!=-1){w=(attrs.width.slice(0,attrs.width.length-1))*$('#'+attrs.id).closest('div').width()/100;}else{w=attrs.width;}if(attrs.height!=undefined&&attrs.height.indexOf('%')!=-1){h=(attrs.height.slice(0,attrs.height.length-1))*$('#'+attrs.id).closest('div').height()/100;}else{h=attrs.height;}var r=(w*55)/230,ir=(w*40)/230,pi=Math.PI,color=[attrs.color1,attrs.color2];data=[{"label":"New","value":data1},{"label":"Repeat","value":scope.rightData-data1}];var vis=d3.select('svg#'+attrs.id).data([data]).attr("width",function(){return w;}).attr("height",function(){return h;}).append("svg:g").attr("transform","translate("+(w/2)+","+(h*85/100)+")");var arc=d3.svg.arc().outerRadius(r).innerRadius(ir);var signed=(scope.rightData/2-data1)/(Math.abs(scope.rightData/2-data1));var pie=d3.layout.pie().value(function(d){return d.value;}).startAngle(90*signed*(pi/180)).endAngle(-90*signed*(pi/180));var arcs=vis.selectAll("g.slice").data(pie).enter().append("svg:g").attr("class","slice");arcs.append("svg:path").attr("fill",function(d,i){return color[i];}).attr("d",arc);vis.append('svg:g').attr('transform','translate('+(r/3)+',0)').append('text').text(data1).attr("style","font-size:"+attrs.middlefont+"px;font-family:'Segoe UI Light' !important");vis.append('svg:g').attr('transform','translate('+(-r-attrs.sidefont*2.5)+',0)').append('text').text('0.00').attr("style","font-size:"+attrs.sidefont+"px"+";font-family:'Segoe UI Light' !important");vis.append('svg:g').attr('transform','translate('+(r+attrs.sidefont*1.1)+',0)').append('text').text(scope.rightData).attr("style","font-size:"+attrs.sidefont+"px;font-family:'Segoe UI Light' !important");var middleFont=$($('#svg3 g>text')[0]).width();var leftFont=$($('#svg3 g>text')[1]).width();var rightFont=$($('#svg3 g>text')[2]).width();var pos=-middleFont/2;var leftPos=-r-leftFont-2;var rightPos=r+2;$($('#svg3 g>text')[0]).remove();$($('#svg3 g>text')[0]).remove();$($('#svg3 g>text')[0]).remove();vis.append('svg:g').attr('transform','translate('+pos+',0)').append('text').text(data1).attr("style","font-size:"+attrs.middlefont+"px;font-family:'Segoe UI Light' !important");vis.append('svg:g').attr('transform','translate('+leftPos+',0)').append('text').text('0.00').attr("style","font-size:"+attrs.sidefont+"px"+";font-family:'Segoe UI Light' !important");vis.append('svg:g').attr('transform','translate('+rightPos+',0)').append('text').text(scope.rightData).attr("style","font-size:"+attrs.sidefont+"px;font-family:'Segoe UI Light' !important");}
_init(scope.middleData);$(window).resize(function(){d3.select('svg#'+attrs.id).selectAll("*").remove();_init(scope.middleData);});}}})